{% extends "base.html" %}
{% block dynamic %}
<div class="container-fluid">
    <div class="d-sm-flex justify-content-between align-items-center mb-4">
        <h3 class="text-dark mb-0">Playlist <span class="badge badge-info badge-counter">Total PLaylist: {{total_playlist}}</span></h3>
        
        <a class="" role="" href="#"></a></div>
    <div class="row">
        <div class="col-md-12">
                <table id="playlist" class="table table-striped table-bordered" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Total Videos Assigned</th>
                            <th>Total Devices</th>
                            <!-- <th>Schedule</th> -->
                            <!-- <th>Delete</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- {% for plast in playlist  %}
                            <tr>
                                <td>{{plast.id}}</td>
                                <td>{{plast.name}}</td>
                                <td>{{plast.video.total_video}}</td>
                                <td>
                                    {% for d in plast.video.devices %}
                                        {{d.name}}
                                    {%endfor%}
                                </td>
                                <td><button type="button" class="btn btn-dark" video_uuid="{{plast}}" data-toggle="modal" data-target="#scheduleModal">Schedule</button></td>
                            </tr>
                        {% endfor %} -->
                    </tbody>
                    <tfoot>
                        
                    </tfoot>
                </table>
            
        </div>

        <!-- Modal -->
        <div id="scheduleModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
        
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        
            </div>
        </div>
    </div>
    
<div class="row">
    <div class="col-lg-6 mb-4">
        
        
    </div>
    <div class="col">
        <div class="row">
            
        </div>
    </div>
</div>
</div>
</div>
{%endblock%}

{% block extra_js %}
<script>
    $(document).ready(function() {
        $.ajax({
                url: '/api/playlist/',
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Access-Control-Allow-Origin": "*",
                    "Authorization": "Bearer " + localStorage.getItem("token"),
                },
                success: function(data, status){
                    var playlist = $('#playlist').DataTable();
                    var datas = []
                    data.forEach(function(dd){
                        temp_data = []
                        temp_data.push(dd.id);
                        temp_data.push(dd.name);
                        temp_data.push(dd.video.total_video);
                        temp_data.push(dd.video.devices.length);
                        datas.push(temp_data);
                    });
                    playlist.rows.add(datas).draw();
                },
                error: function(data, status, error){
                    alert(error);
                }
        })
            
    });

    function deletePlaylist(devices, uuid, user) {
        if (confirm("Do you really want to delete the playlist. It will be removed from the device") == true) {
            
            $.ajax({
                url: '/api/playlist/'+uuid+ '/' + '?username=' + user,
                type: "DELETE",
                success: function(data, status){
                    alert(status);
                },
                error: function(data, status, error){
                    alert(error);
                }
            })
        } else {
            alert("Delete operation cancelled.")
        }
    }
</script>
{%endblock%}